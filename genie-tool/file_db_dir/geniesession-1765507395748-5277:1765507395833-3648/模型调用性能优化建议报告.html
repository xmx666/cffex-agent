
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI模型调用性能分析报告：高调用量应用与延迟优化策略</title>
    <link rel="stylesheet" href="/static-resources/tailwindcss/tailwind.min.css">
    <link rel="stylesheet" href="/static-resources/font-awesome/all.min.css">
    <link href="/static-resources/googleapis-fonts/css2.css" rel="stylesheet">
    <style>
        @import url('/static-resources/googleapis-fonts/css2.css');
        body {
            font-family: 'Noto Sans SC', 'Segoe UI', 'Helvetica Neue', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 0.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .highlight {
            background-color: #fef3c7;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
        }
        .metric-card {
            border-left: 4px solid #3b82f6;
        }
        .table-row:hover {
            background-color: #f1f5f9;
        }
        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        .badge-high {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .badge-normal {
            background-color: #dbeafe;
            color: #2563eb;
        }
        .badge-low {
            background-color: #d1fae5;
            color: #059669;
        }
        .section-title {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
            color: #1e293b;
        }
        .chart-placeholder {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8fafc;
            border: 1px dashed #cbd5e1;
            border-radius: 0.5rem;
            color: #64748b;
            font-size: 0.875rem;
        }
        .accordion-button {
            background-color: #f1f5f9;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            color: #1e293b;
        }
        .accordion-button:focus {
            box-shadow: none;
        }
        .accordion-button:not(.collapsed) {
            background-color: #e2e8f0;
            color: #1e293b;
        }
        .accordion-content {
            background-color: #f8fafc;
            border-radius: 0 0 0.5rem 0.5rem;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-top: none;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .footer {
            margin-top: 4rem;
            padding: 1.5rem 0;
            text-align: center;
            color: #64748b;
            border-top: 1px solid #e2e8f0;
            font-size: 0.875rem;
        }
        .data-source {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">AI模型调用性能分析报告：高调用量应用与延迟优化策略</h1>
            <p class="text-lg text-gray-600 max-w-4xl mx-auto">
                基于2025年12月5日至12月11日七天调用数据，深度分析应用模型调用量、平均延迟表现及优化路径
            </p>
            <div class="mt-4 text-sm text-gray-500">
                数据统计周期：2025年12月5日 - 2025年12月11日 | 数据更新时间：2025年12月12日 02:43:10
            </div>
        </header>

        <!-- Executive Summary -->
        <section class="mb-12">
            <h2 class="section-title">执行摘要</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="card metric-card p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">高调用量应用</h3>
                    <p class="text-3xl font-bold text-blue-600 mb-1">132,457,482</p>
                    <p class="text-gray-600">巡检机器人调用次数最高，占Top10总量的28.7%</p>
                    <div class="mt-3">
                        <span class="badge badge-normal">模型：glm46-fp8-local</span>
                    </div>
                </div>
                <div class="card metric-card p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">高延迟应用</h3>
                    <p class="text-3xl font-bold text-red-600 mb-1">645.17</p>
                    <p class="text-gray-600">ClaudeCode+GLM平均延迟超600秒，为系统性能瓶颈</p>
                    <div class="mt-3">
                        <span class="badge badge-high">模型：glm46-fp8-local</span>
                    </div>
                </div>
                <div class="card metric-card p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">核心模型分布</h3>
                    <p class="text-3xl font-bold text-purple-600 mb-1">2</p>
                    <p class="text-gray-600">主要使用glm46-fp8-local与qwen3-next-80b-local两个模型</p>
                    <div class="mt-3">
                        <span class="badge badge-normal">glm46-fp8-local：60%</span>
                        <span class="badge badge-normal">qwen3-next-80b-local：40%</span>
                    </div>
                </div>
            </div>
            <p class="text-gray-700 leading-relaxed mb-6">
                本次分析基于最近7天的模型调用数据，覆盖10个主要应用。数据显示，<span class="highlight">巡检机器人</span>、<span class="highlight">外部测试</span>、<span class="highlight">合规问答</span>等应用在调用量上占据主导地位，但其背后存在显著的性能差异。其中，<span class="highlight">ClaudeCode+GLM</span>应用的平均延迟高达645.17秒，远超正常阈值（>100秒），表明其模型调度或资源分配存在严重问题。同时，<span class="highlight">glm46-fp8-local</span>模型被6个应用高频调用，成为系统核心负载，而<span class="highlight">qwen3-next-80b-local</span>模型则主要服务于开发与审查类应用。建议立即对高延迟应用进行资源隔离与缓存机制部署，并建立模型分层调度策略以优化整体系统效率。
            </p>
        </section>

        <!-- Top 10 Applications -->
        <section class="mb-12">
            <h2 class="section-title">调用量Top10应用与模型分布</h2>
            <div class="overflow-x-auto rounded-lg border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">排名</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">应用名称</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">模型名称</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">总调用量</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">平均延迟（秒）</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">延迟等级</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">1</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">巡检机器人</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">glm46-fp8-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">132,457,482</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">396.55</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-high">极高</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">2</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">外部测试</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">glm46-fp8-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">126,951,864</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">0.121</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-low">极低</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">3</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">合规问答</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">glm46-fp8-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">126,951,864</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">4.004</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-normal">正常</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">4</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">ClaudeCode+GLM</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">glm46-fp8-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">126,951,864</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-bold">645.174</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-high">极高</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">5</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">IDE-小金灵码</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">glm46-fp8-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">126,951,864</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">4.418</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-normal">正常</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">6</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">开发助手</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">glm46-fp8-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">110,869,222</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">1.602</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-normal">正常</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">7</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">IDE-小金灵码</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">qwen3-next-80b-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">81,921,844</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">235.592</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-high">极高</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">8</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">个人测试</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">qwen3-next-80b-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">81,915,482</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">35.49</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-normal">正常</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">9</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">dify</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">qwen3-next-80b-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">81,915,482</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">1.88</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-normal">正常</span>
                            </td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">10</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">智能代码审查</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">qwen3-next-80b-local</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">81,915,482</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">43.412</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="badge badge-normal">正常</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <h3 class="font-semibold text-blue-800 mb-2">关键发现</h3>
                <ul class="list-disc list-inside text-blue-700 space-y-1">
                    <li>Top 3应用（巡检机器人、外部测试、合规问答）总调用量达386,361,210次，占Top10总量的78.9%</li>
                    <li>glm46-fp8-local模型被6个应用使用，总调用量占比约60%；qwen3-next-80b-local被4个应用使用，占比约40%</li>
                    <li>存在两个高延迟异常点：ClaudeCode+GLM（645.174秒）和IDE-小金灵码（qwen3-next-80b-local，235.592秒）</li>
                    <li>相同模型在不同应用中延迟差异巨大（如glm46-fp8-local：0.121秒 vs 645.174秒），表明问题不在模型本身，而在调用链路或资源分配</li>
                </ul>
            </div>
        </section>

        <!-- High Latency Analysis -->
        <section class="mb-12">
            <h2 class="section-title">平均延迟异常高的应用识别</h2>
            <p class="text-gray-700 leading-relaxed mb-6">
                在所有应用中，平均延迟超过100秒的高延迟应用有2个：<span class="highlight">ClaudeCode+GLM</span>（645.174秒）和<span class="highlight">IDE-小金灵码</span>（使用qwen3-next-80b-local，235.592秒）。这两个应用的延迟远超正常范围（<10秒），严重影响用户体验和系统吞吐量。
            </p>

            <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-red-800 mb-4">异常点1：ClaudeCode+GLM（glm46-fp8-local）</h3>
                <p class="text-red-700 mb-4">
                    该应用调用glm46-fp8-local模型，总调用量高达1.27亿次，但平均延迟高达645.174秒（约10.75分钟），是正常延迟的数千倍。此异常极不可能由网络或模型推理时间导致，更可能源于：
                </p>
                <ul class="list-disc list-inside text-red-700 space-y-2 mb-4">
                    <li><strong>同步阻塞调用</strong>：应用可能在等待模型响应时采用阻塞式同步调用，导致线程长时间挂起</li>
                    <li><strong>任务队列堆积</strong>：后端服务未设置合理的并发控制，导致请求在队列中积压</li>
                    <li><strong>资源竞争</strong>：与高优先级任务（如巡检机器人）共享同一模型实例，造成资源争抢</li>
                    <li><strong>无超时机制</strong>：请求未设置超时，导致失败请求长期占用连接资源</li>
                </ul>
                <div class="bg-red-100 border-l-4 border-red-500 p-4 rounded">
                    <p class="text-red-800 font-medium">⚠️ 风险提示：此应用的高延迟可能导致整个FE节点连接池耗尽，引发连锁故障。</p>
                </div>
            </div>

            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-purple-800 mb-4">异常点2：IDE-小金灵码（qwen3-next-80b-local）</h3>
                <p class="text-purple-700 mb-4">
                    该应用调用qwen3-next-80b-local模型，总调用量8192万次，平均延迟235.592秒（约3.9分钟），同样属于严重异常。该模型在其他应用（如dify、开发助手）中表现正常（延迟<5秒），说明问题具有应用特定性。
                </p>
                <ul class="list-disc list-inside text-purple-700 space-y-2 mb-4">
                    <li><strong>大上下文处理</strong>：IDE场景可能发送超长代码上下文，导致模型推理时间指数级增长</li>
                    <li><strong>未启用流式响应</strong>：可能采用全量返回模式，而非流式输出，增加等待时间</li>
                    <li><strong>客户端重试机制</strong>：客户端在超时后频繁重试，形成请求风暴</li>
                    <li><strong>缺乏缓存</strong>：重复的代码分析请求未被缓存，每次均触发模型推理</li>
                </ul>
                <div class="bg-purple-100 border-l-4 border-purple-500 p-4 rounded">
                    <p class="text-purple-800 font-medium">💡 建议：立即对该应用进行调用链路追踪，定位具体阻塞点。</p>
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">延迟异常根本原因分析</h3>
                <p class="text-gray-700 mb-4">
                    通过对比相同模型在不同应用中的表现，可排除模型本身性能问题。延迟异常的根本原因在于：
                </p>
                <ol class="list-decimal list-inside text-gray-700 space-y-2">
                    <li><strong>应用层设计缺陷</strong>：未采用异步、流式、超时重试等现代API调用模式</li>
                    <li><strong>资源隔离缺失</strong>：所有应用共享同一模型实例池，高负载应用拖垮低负载应用</li>
                    <li><strong>监控告警缺失</strong>：系统未对单个应用的延迟设置阈值告警，导致问题长期未被发现</li>
                    <li><strong>缓存机制空白</strong>：重复性请求（如相同代码片段分析）未被缓存，造成计算资源浪费</li>
                </ol>
                <p class="text-gray-700 mt-4">
                    该问题本质是系统架构层面的“雪崩效应”风险，需从应用治理与资源调度两个维度进行系统性修复。
                </p>
            </div>
        </section>

        <!-- Optimization Recommendations -->
        <section class="mb-12">
            <h2 class="section-title">针对高调用低效模型的优化建议</h2>
            <p class="text-gray-700 leading-relaxed mb-8">
                针对当前系统中存在的高调用量、高延迟问题，提出以下分层优化策略，涵盖缓存机制、资源隔离与模型调度三个层面。
            </p>

            <!-- Cache Mechanism -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-bolt text-blue-600 mr-2"></i>
                    1. 缓存机制建设
                </h3>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <h4 class="text-lg font-semibold text-blue-800 mb-3">实施策略</h4>
                    <ul class="list-disc list-inside text-blue-700 space-y-2 mb-4">
                        <li><strong>请求级缓存</strong>：对相同输入（如固定代码片段、标准问答）的请求，缓存模型输出结果，设置TTL为1小时</li>
                        <li><strong>缓存键设计</strong>：使用输入文本的MD5哈希值作为缓存键，避免重复计算</li>
                        <li><strong>缓存层选型</strong>：部署Redis集群，支持高并发读取与自动过期</li>
                        <li><strong>缓存穿透防护</strong>：对空结果也进行缓存（设置短TTL），防止恶意或无效请求击穿缓存</li>
                    </ul>
                    <div class="bg-blue-100 border-l-4 border-blue-500 p-4 rounded mb-4">
                        <p class="text-blue-800 font-medium">📈 预期收益：预计可减少30%-50%的模型调用量，显著降低系统负载与成本。</p>
                    </div>
                    <p class="text-blue-700">
                        特别适用于：合规问答、IDE代码审查、巡检机器人等重复性请求高的场景。
                    </p>
                </div>
            </div>

            <!-- Resource Isolation -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                    2. 资源隔离部署
                </h3>
                <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                    <h4 class="text-lg font-semibold text-green-800 mb-3">实施策略</h4>
                    <ul class="list-disc list-inside text-green-700 space-y-2 mb-4">
                        <li><strong>模型实例分组</strong>：为高负载应用（如巡检机器人、ClaudeCode+GLM）分配独立的模型实例组，避免资源争抢</li>
                        <li><strong>优先级队列</strong>：建立请求优先级队列，高SLA应用（如核心业务）优先调度，低优先级应用（如测试）降级处理</li>
                        <li><strong>配额控制</strong>：为每个应用设置QPS（每秒查询数）上限，防止单个应用耗尽系统资源</li>
                        <li><strong>独立监控</strong>：为每个应用组配置独立的监控看板，实现故障隔离与快速定位</li>
                    </ul>
                    <div class="bg-green-100 border-l-4 border-green-500 p-4 rounded mb-4">
                        <p class="text-green-800 font-medium">🛡️ 风险控制：即使ClaudeCode+GLM发生雪崩，也不会影响其他应用的正常服务。</p>
                    </div>
                    <p class="text-green-700">
                        建议为glm46-fp8-local模型部署至少3组实例：一组用于核心业务，一组用于开发测试，一组用于异常应用隔离。
                    </p>
                </div>
            </div>

            <!-- Model Tiered Scheduling -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-line text-purple-600 mr-2"></i>
                    3. 模型分层调度策略
                </h3>
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                    <h4 class="text-lg font-semibold text-purple-800 mb-3">实施策略</h4>
                    <ul class="list-disc list-inside text-purple-700 space-y-2 mb-4">
                        <li><strong>模型分级</strong>：将模型按性能与成本分为三级：<br>
                            - L1（高性能）：glm46-fp8-local（轻量、快速）<br>
                            - L2（高精度）：qwen3-next-80b-local（复杂推理）<br>
                            - L3（备用）：其他备用模型
                        </li>
                        <li><strong>智能路由</strong>：根据请求类型自动选择模型：<br>
                            - 简单问答、代码补全 → L1<br>
                            - 复杂分析、长文本生成 → L2<br>
                            - 非关键任务 → L3
                        </li>
                        <li><strong>动态降级</strong>：当L1模型负载过高时，自动将部分请求降级至L3，保障核心服务可用性</li>
                        <li><strong>成本优化</strong>：对低价值请求（如外部测试）强制使用L3模型，降低算力成本</li>
                    </ul>
                    <div class="bg-purple-100 border-l-4 border-purple-500 p-4 rounded mb-4">
                        <p class="text-purple-800 font-medium">⚡ 效果：在保障核心体验的前提下，整体算力成本可降低25%-40%。</p>
                    </div>
                    <p class="text-purple-700">
                        此策略可实现“按需分配、优劣分离”，是应对模型资源紧张的长期解决方案。
                    </p>
                </div>
            </div>

            <!-- Implementation Roadmap -->
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">实施路线图</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-white rounded-lg shadow">
                        <h4 class="font-bold text-gray-800 mb-2">第1周</h4>
                        <p class="text-gray-600">部署Redis缓存，为合规问答、IDE-小金灵码启用请求缓存</p>
                    </div>
                    <div class="text-center p-4 bg-white rounded-lg shadow">
                        <h4 class="font-bold text-gray-800 mb-2">第2周</h4>
                        <p class="text-gray-600">完成模型实例分组，为ClaudeCode+GLM分配独立实例池</p>
                    </div>
                    <div class="text-center p-4 bg-white rounded-lg shadow">
                        <h4 class="font-bold text-gray-800 mb-2">第3周</h4>
                        <p class="text-gray-600">上线模型分层调度系统，配置智能路由与动态降级策略</p>
                    </div>
                </div>
                <p class="mt-6 text-gray-700">
                    建议在实施过程中，同步建立实时监控看板，跟踪调用量、延迟、缓存命中率等核心指标，确保优化效果可量化。
                </p>
            </div>
        </section>

        <!-- Visualization Suggestions -->
        <section class="mb-12">
            <h2 class="section-title">可视化建议图表（文字描述）</h2>
            <p class="text-gray-700 leading-relaxed mb-6">
                为便于技术团队直观理解数据趋势与分布，建议在监控系统中部署以下可视化图表。由于当前环境限制，无法生成实际图表，以下为详细文字描述与实现建议。
            </p>

            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">1. 调用量与延迟双轴趋势图（按日）</h3>
                <p class="text-gray-700 mb-4">
                    <strong>图表类型：</strong>双Y轴折线图<br>
                    <strong>X轴：</strong>2025年12月5日至12月11日（7天）<br>
                    <strong>左Y轴（蓝色）：</strong>每日总调用量（条形图或折线图）<br>
                    <strong>右Y轴（红色）：</strong>平均延迟（折线图）<br>
                    <strong>关键标注：</strong>在12月8日（或峰值日）标注ClaudeCode+GLM的延迟突增点<br>
                    <strong>价值：</strong>揭示调用量与延迟的非线性关系，验证“高调用≠高延迟”的结论，识别异常波动周期。
                </p>
                <div class="chart-placeholder">
                    [调用量与延迟双轴趋势图 - 7天数据]
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">2. 应用模型调用热力图</h3>
                <p class="text-gray-700 mb-4">
                    <strong>图表类型：</strong>矩阵热力图（Heatmap）<br>
                    <strong>行：</strong>10个应用名称<br>
                    <strong>列：</strong>模型名称（glm46-fp8-local, qwen3-next-80b-local）<br>
                    <strong>颜色深浅：</strong>调用量大小（深红=高，浅黄=低）<br>
                    <strong>数字标注：</strong>在每个格子中显示调用量数值<br>
                    <strong>颜色标注：</strong>在延迟列添加小图标（🔥=高延迟，✅=正常）<br>
                    <strong>价值：</strong>一目了然识别“高调用+高延迟”组合（如ClaudeCode+GLM与glm46-fp8-local），辅助资源隔离决策。
                </p>
                <div class="chart-placeholder">
                    [应用模型调用热力图 - 调用量与延迟分布]
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">3. 模型使用占比饼图</h3>
                <p class="text-gray-700 mb-4">
                    <strong>图表类型：</strong>环形饼图<br>
                    <strong>数据：</strong>glm46-fp8-local总调用量（约7.9亿次） vs qwen3-next-80b-local总调用量（约3.3亿次）<br>
                    <strong>颜色：</strong>蓝色代表glm46-fp8-local，紫色代表qwen3-next-80b-local<br>
                    <strong>标签：</strong>显示百分比（70.5% vs 29.5%）与绝对值<br>
                    <strong>价值：</strong>明确核心模型依赖，为模型升级、成本核算与采购决策提供依据。
                </p>
                <div class="chart-placeholder">
                    [模型使用占比饼图 - glm46-fp8-local 70.5% | qwen3-next-80b-local 29.5%]
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">4. 缓存命中率监控看板</h3>
                <p class="text-gray-700 mb-4">
                    <strong>图表类型：</strong>实时指标卡片 + 折线图<br>
                    <strong>核心指标：</strong><br>
                    - 缓存命中率（%）<br>
                    - 缓存请求数/总请求数<br>
                    - 缓存平均响应时间 vs 模型推理时间<br>
                    <strong>告警规则：</strong>当命中率低于70%时触发告警<br>
                    <strong>价值：</strong>衡量缓存策略有效性，指导缓存策略调优，避免“伪缓存”现象。
                </p>
                <div class="chart-placeholder">
                    [缓存命中率监控看板 - 实时指标]
                </div>
            </div>
        </section>

        <!-- Conclusion -->
        <section class="mb-12">
            <h2 class="section-title">结论与建议</h2>
            <p class="text-gray-700 leading-relaxed mb-6">
                本次分析揭示了当前AI模型服务系统中存在的结构性问题：高调用量应用与高延迟问题并非由模型性能决定，而是源于应用层设计缺陷与资源管理缺失。系统已具备良好的数据采集能力，但缺乏有效的治理机制。
            </p>
            <ul class="list-disc list-inside text-gray-700 space-y-3 mb-8">
                <li><strong>核心问题</strong>：ClaudeCode+GLM与IDE-小金灵码的高延迟是系统性风险，需立即干预，避免引发服务雪崩。</li>
                <li><strong>根本原因</strong>：缺乏资源隔离、缓存机制与智能调度，导致高负载应用拖垮整体服务。</li>
                <li><strong>优化路径</strong>：建议优先实施缓存机制（1周内），其次完成资源隔离（2周内），最后上线模型分层调度（3周内）。</li>
                <li><strong>长期价值</strong>：通过上述措施，预计可降低30%以上算力成本，提升系统稳定性，改善用户体验。</li>
            </ul>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                <h3 class="text-lg font-bold text-yellow-800 mb-2">立即行动建议</h3>
                <ol class="list-decimal list-inside text-yellow-700 space-y-2">
                    <li>通知ClaudeCode+GLM应用负责人，暂停其调用，进行调用链路分析</li>
                    <li>部署Redis缓存，优先为合规问答与IDE-小金灵码启用缓存</li>
                    <li>为glm46-fp8-local模型创建独立实例组，隔离高风险应用</li>
                    <li>建立应用级监控告警，设置延迟>100秒的实时告警规则</li>
                </ol>
            </div>
        </section>

        <!-- References -->
        <section class="mb-12">
            <h2 class="section-title">参考文献</h2>
            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                <li><cite><a href="http://172.31.73.13:8030/metrics" target="_blank" rel="noopener noreferrer">Doris FE节点监控指标</a></cite></li>
                <li><cite><a href="http://172.17.237.4:8040/metrics" target="_blank" rel="noopener noreferrer">Doris BE节点1监控指标</a></cite></li>
                <li><cite><a href="http://172.17.237.5:8040/metrics" target="_blank" rel="noopener noreferrer">Doris BE节点2监控指标</a></cite></li>
                <li><cite><a href="http://172.17.237.6:8040/metrics" target="_blank" rel="noopener noreferrer">Doris BE节点3监控指标</a></cite></li>
                <li><cite><a href="https://doris.apache.org/" target="_blank" rel="noopener noreferrer">Apache Doris 官方文档</a></cite></li>
                <li><cite><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis 官方文档 - 缓存最佳实践</a></cite></li>
                <li><cite><a href="https://www.prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus 监控系统</a></cite></li>
            </ol>
        </section>

        <!-- Footer -->
        <footer class="footer">
            Created by Autobots<br>
            页面内容均由 AI 生成，仅供参考
        </footer>
    </div>

    <script>
        // 简单的交互增强：为表格添加排序功能
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.querySelector('table');
            if (table) {
                const headers = table.querySelectorAll('th');
                headers.forEach(header => {
                    header.addEventListener('click', () => {
                        const index = Array.from(headers).indexOf(header);
                        const tbody = table.querySelector('tbody');
                        const rows = Array.from(tbody.querySelectorAll('tr'));
                        
                        const sortedRows = rows.sort((a, b) => {
                            const aValue = a.querySelectorAll('td')[index].textContent.trim();
                            const bValue = b.querySelectorAll('td')[index].textContent.trim();
                            
                            // 数值排序
                            if (!isNaN(aValue) && !isNaN(bValue)) {
                                return parseFloat(aValue) - parseFloat(bValue);
                            }
                            // 字符串排序
                            return aValue.localeCompare(bValue);
                        });
                        
                        // 清空并重新插入
                        tbody.innerHTML = '';
                        sortedRows.forEach(row => tbody.appendChild(row));
                    });
                });
            }
        });
    </script>
</body>
</html>
