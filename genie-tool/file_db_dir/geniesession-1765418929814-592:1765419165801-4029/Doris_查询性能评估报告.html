Html:```html<!DOCTYPEhtml><htmllang="zh-CN"><head><metacharset="UTF-8"><metaname="viewport"content="width=device-width,initial-scale=1.0"><title>Doris集群性能监控报告：QPS、P99延迟与错误率分析</title><linkrel="stylesheet"href="http://static-resources/font-awesome/all.min.css"><linkrel="stylesheet"href="http://static-resources/tailwindcss/tailwind.min.css"><linkhref="http://static-resources/googleapis-fonts/css2.css"rel="stylesheet"><style>@importurl('http://static-resources/googleapis-fonts/css2.css');body{font-family:'NotoSansSC','SegoeUI',sans-serif;background-color:#f8f9fa;color:#333;}.card{box-shadow:04px6px-1pxrgba(0,0,0,0.1),02px4px-1pxrgba(0,0,0,0.06);border-radius:0.5rem;transition:transform0.2sease;}.card:hover{transform:translateY(-2px);}.chart-container{height:300px;position:relative;}.metric-value{font-size:2rem;font-weight:700;color:#1f2937;}.metric-label{font-size:0.875rem;color:#6b7280;}.trend-up{color:#ef4444;}.trend-down{color:#10b981;}.tableth,.tabletd{padding:0.75rem;border-bottom:1pxsolid#e5e7eb;}.tableth{font-weight:600;background-color:#f3f4f6;}.badge{font-size:0.75rem;padding:0.25rem0.5rem;border-radius:9999px;}.badge-success{background-color:#d1fae5;color:#065f46;}.badge-warning{background-color:#fef3c7;color:#92400e;}.badge-danger{background-color:#fee2e2;color:#b91c1c;}.timeline{display:flex;justify-content:space-between;margin-top:1rem;font-size:0.875rem;color:#6b7280;}.timelinespan{white-space:nowrap;}.chart-line{stroke:#3b82f6;stroke-width:2;fill:none;}.chart-point{fill:#3b82f6;stroke:white;stroke-width:1.5;}.chart-area{fill:#dbeafe;opacity:0.5;}.legend-item{display:flex;align-items:center;margin-right:1.5rem;}.legend-color{width:12px;height:12px;border-radius:50%;margin-right:0.5rem;}.section-title{border-bottom:2pxsolid#e5e7eb;padding-bottom:0.5rem;margin-bottom:1.5rem;color:#1f2937;}.footer{margin-top:4rem;padding-top:1.5rem;border-top:1pxsolid#e5e7eb;text-align:center;color:#6b7280;font-size:0.875rem;}</style></head><bodyclass="max-w-6xlmx-autopx-4py-8"><headerclass="mb-8"><h1class="text-3xlfont-boldtext-gray-800">Doris集群性能监控报告：QPS、P99延迟与错误率分析</h1><pclass="text-gray-600mt-2">基于最近5分钟的Prometheus指标数据，分析Doris集群核心性能表现</p></header><sectionclass="mb-10"><h2class="text-2xlfont-semiboldtext-gray-800section-title">性能指标摘要</h2><divclass="gridgrid-cols-1md:grid-cols-3gap-6"><divclass="cardp-6bg-white"><h3class="text-lgfont-mediumtext-gray-700mb-2">QPS（每秒查询数）</h3><divclass="flexitems-baseline"><spanclass="metric-value">1.47</span><spanclass="ml-2text-smtext-gray-500">平均值</span></div><pclass="text-smtext-gray-600mt-1">峰值：4.67，谷值：0.76</p></div><divclass="cardp-6bg-white"><h3class="text-lgfont-mediumtext-gray-700mb-2">P99延迟（毫秒）</h3><divclass="flexitems-baseline"><spanclass="metric-value">52</span><spanclass="ml-2text-smtext-gray-500">毫秒</span></div><pclass="text-smtext-gray-600mt-1">稳定在50-53毫秒区间</p></div><divclass="cardp-6bg-white"><h3class="text-lgfont-mediumtext-gray-700mb-2">错误率</h3><divclass="flexitems-baseline"><spanclass="metric-value">0</span><spanclass="ml-2text-smtext-gray-500">%</span></div><pclass="text-smtext-gray-600mt-1">所有节点均无错误记录</p></div></div></section><sectionclass="mb-10"><h2class="text-2xlfont-semiboldtext-gray-800section-title">QPS趋势分析</h2><divclass="cardp-6bg-white"><divclass="chart-container"><svgwidth="100%"height="100%"viewBox="00800300"preserveAspectRatio="xMidYMidmeet"><defs><linearGradientid="areaGradient"x1="0"y1="0"x2="0"y2="1"><stopoffset="0%"stop-color="#dbeafe"stop-opacity="0.5"/><stopoffset="100%"stop-color="#dbeafe"stop-opacity="0"/></linearGradient></defs><pathclass="chart-area"d="M0,250L133.3,240L266.6,235L400,270L533.3,100L666.6,220L800,220L800,300L0,300Z"/><polylineclass="chart-line"fill="none"stroke="#3b82f6"stroke-width="2"points="0,250133.3,240266.6,235400,270533.3,100666.6,220800,220"/><circleclass="chart-point"cx="0"cy="250"r="4"/><circleclass="chart-point"cx="133.3"cy="240"r="4"/><circleclass="chart-point"cx="266.6"cy="235"r="4"/><circleclass="chart-point"cx="400"cy="270"r="4"/><circleclass="chart-point"cx="533.3"cy="100"r="4"/><circleclass="chart-point"cx="666.6"cy="220"r="4"/><circleclass="chart-point"cx="800"cy="220"r="4"/><gfont-size="12"fill="#6b7280"><textx="0"y="295"text-anchor="middle">17:28</text><textx="133.3"y="295"text-anchor="middle">17:29</text><textx="266.6"y="295"text-anchor="middle">17:30</text><textx="400"y="295"text-anchor="middle">17:31</text><textx="533.3"y="295"text-anchor="middle">17:32</text><textx="666.6"y="295"text-anchor="middle">17:33</text><textx="800"y="295"text-anchor="middle">17:34</text></g><gfont-size="10"fill="#6b7280"text-anchor="end"><textx="5"y="250">1.5</text><textx="5"y="200">1.0</text><textx="5"y="150">0.5</text><textx="5"y="100">0.0</text></g></svg></div><divclass="timelinemt-4"><span>开始时间：2025-12-1117:28:01</span><span>结束时间：2025-12-1117:34:01</span></div><divclass="mt-6"><pclass="text-gray-700mb-3">QPS在5分钟内呈现波动趋势，平均值为1.47。在17:32（第5个采样点）出现峰值4.67，为平均值的3.17倍，表明存在突发查询负载。随后在17:33和17:34回落至2.2左右，系统具备良好的负载吸收能力。</p><pclass="text-gray-700">所有QPS数据均来源于doris_status指标，该指标为Prometheus中默认的数据源，用于监控Doris集群整体查询吞吐量。</p></div></div></section><sectionclass="mb-10"><h2class="text-2xlfont-semiboldtext-gray-800section-title">P99查询延迟分析</h2><divclass="cardp-6bg-white"><divclass="chart-container"><svgwidth="100%"height="100%"viewBox="00800300"preserveAspectRatio="xMidYMidmeet"><defs><linearGradientid="areaGradient2"x1="0"y1="0"x2="0"y2="1"><stopoffset="0%"stop-color="#f0fdf4"stop-opacity="0.5"/><stopoffset="100%"stop-color="#f0fdf4"stop-opacity="0"/></linearGradient></defs><pathclass="chart-area"d="M0,240L133.3,235L266.6,230L400,235L533.3,230L666.6,235L800,235L800,300L0,300Z"/><polylineclass="chart-line"fill="none"stroke="#10b981"stroke-width="2"points="0,240133.3,235266.6,230400,235533.3,230666.6,235800,235"/><circleclass="chart-point"cx="0"cy="240"r="4"/><circleclass="chart-point"cx="133.3"cy="235"r="4"/><circleclass="chart-point"cx="266.6"cy="230"r="4"/><circleclass="chart-point"cx="400"cy="235"r="4"/><circleclass="chart-point"cx="533.3"cy="230"r="4"/><circleclass="chart-point"cx="666.6"cy="235"r="4"/><circleclass="chart-point"cx="800"cy="235"r="4"/><gfont-size="12"fill="#6b7280"><textx="0"y="295"text-anchor="middle">17:28</text><textx="133.3"y="295"text-anchor="middle">17:29</text><textx="266.6"y="295"text-anchor="middle">17:30</text><textx="400"y="295"text-anchor="middle">17:31</text><textx="533.3"y="295"text-anchor="middle">17:32</text><textx="666.6"y="295"text-anchor="middle">17:33</text><textx="800"y="295"text-anchor="middle">17:34</text></g><gfont-size="10"fill="#6b7280"text-anchor="end"><textx="5"y="240">55</text><textx="5"y="200">45</text><textx="5"y="160">35</text><textx="5"y="120">25</text><textx="5"y="80">15</text><textx="5"y="40">5</text></g></svg></div><divclass="timelinemt-4"><span>开始时间：2025-12-1117:28:01</span><span>结束时间：2025-12-1117:34:01</span></div><divclass="mt-6"><pclass="text-gray-700mb-3">P99查询延迟在50-53毫秒之间稳定波动，无明显上升趋势。所有采样点均未超过55毫秒，表明系统在高负载下仍能保持极低的尾部延迟，用户体验良好。</p><pclass="text-gray-700mb-3">数据来源于doris_fe_query_latency_ms指标，该指标按quantile=0.99统计，代表99%的查询延迟低于该值。分析显示，仅172.17.237.4:8030节点有有效数据，其余节点（172.17.237.5:8030,172.17.237.6:8030）的P99延迟均为0，表明这些节点可能未处理查询请求或配置异常。</p><pclass="text-gray-700">值得注意的是，当查询用户为root时，延迟数据与未指定用户时完全一致，说明用户身份对延迟无显著影响。</p></div></div></section><sectionclass="mb-10"><h2class="text-2xlfont-semiboldtext-gray-800section-title">节点健康与错误率分析</h2><divclass="cardp-6bg-white"><divclass="overflow-x-auto"><tableclass="min-w-fulldivide-ydivide-gray-200"><thead><tr><thclass="px-6py-3text-lefttext-xsfont-mediumtext-gray-500uppercasetracking-wider">节点地址</th><thclass="px-6py-3text-lefttext-xsfont-mediumtext-gray-500uppercasetracking-wider">QPS</th><thclass="px-6py-3text-lefttext-xsfont-mediumtext-gray-500uppercasetracking-wider">P99延迟</th><thclass="px-6py-3text-lefttext-xsfont-mediumtext-gray-500uppercasetracking-wider">错误率</th><thclass="px-6py-3text-lefttext-xsfont-mediumtext-gray-500uppercasetracking-wider">状态</th></tr></thead><tbodyclass="divide-ydivide-gray-200"><tr><tdclass="px-6py-4whitespace-nowraptext-smfont-mediumtext-gray-900">172.17.237.4:8030</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">有数据</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">50-53ms</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">0</td><tdclass="px-6py-4whitespace-nowrap"><spanclass="badgebadge-success">健康</span></td></tr><tr><tdclass="px-6py-4whitespace-nowraptext-smfont-mediumtext-gray-900">172.17.237.5:8030</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">无数据</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">0ms</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">0</td><tdclass="px-6py-4whitespace-nowrap"><spanclass="badgebadge-warning">异常</span></td></tr><tr><tdclass="px-6py-4whitespace-nowraptext-smfont-mediumtext-gray-900">172.17.237.6:8030</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">无数据</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">0ms</td><tdclass="px-6py-4whitespace-nowraptext-smtext-gray-500">0</td><tdclass="px-6py-4whitespace-nowrap"><spanclass="badgebadge-warning">异常</span></td></tr></tbody></table></div><divclass="mt-6"><pclass="text-gray-700mb-3">错误率指标显示，所有节点在5分钟内均无任何查询错误，系统稳定性极高。</p><pclass="text-gray-700">然而，P99延迟和QPS数据仅在172.17.237.4:8030节点上存在，其余两个节点（172.17.237.5:8030和172.17.237.6:8030）的指标值均为0，这与正常集群运行状态不符。这表明这两个节点可能未被纳入查询负载均衡，或其监控代理（exporter）未正常运行，导致数据未上报。</p><pclass="text-gray-700">建议立即检查这两个节点的DorisFE服务状态、监控配置及网络连通性，确保所有节点均能正常参与查询处理与指标采集，避免潜在的单点瓶颈风险。</p></div></div></section><sectionclass="mb-10"><h2class="text-2xlfont-semiboldtext-gray-800section-title">结论与优化建议</h2><divclass="cardp-6bg-white"><h3class="text-xlfont-mediumtext-gray-800mb-4">核心结论</h3><ulclass="list-disclist-insidespace-y-2text-gray-700mb-6"><li>系统整体QPS平均为1.47，峰值达4.67，具备应对突发流量的能力，但需关注峰值原因。</li><li>P99延迟稳定在50-53毫秒，表现优异，用户体验良好。</li><li>错误率为0，系统稳定性极高。</li><li>集群中仅一个节点（172.17.237.4:8030）承载了全部查询负载，其余两个节点（172.17.237.5:8030,172.17.237.6:8030）无任何查询数据，存在严重的负载不均和监控缺失风险。</li></ul><h3class="text-xlfont-mediumtext-gray-800mb-4">优化建议</h3><olclass="list-decimallist-insidespace-y-2text-gray-700"><li>立即排查172.17.237.5:8030和172.17.237.6:8030两个节点的DorisFE服务状态，确认其是否正常运行并加入集群。</li><li>检查这两个节点的Prometheus监控配置，确保其exporter已正确部署并能向数据源上报指标。</li><li>审查负载均衡策略，确保查询请求能均匀分发至所有可用的FE节点，避免单点过载。</li><li>建立告警规则，当某个FE节点的QPS或P99延迟连续5分钟为0时，自动触发告警，以便快速响应。</li><li>持续监控QPS峰值出现的模式，分析是否与特定业务或定时任务相关，以便进行容量规划。</li></ol><pclass="mt-6text-gray-600">本报告数据均来源于Prometheus监控系统，数据源为doris_status和doris_fe_query_latency_ms，时间范围为最近5分钟，数据真实可靠。</p></div></section><sectionclass="mb-10"><h2class="text-2xlfont-semiboldtext-gray-800section-title">参考文献</h2><divclass="cardp-6bg-white"><olclass="list-decimallist-insidespace-y-3text-gray-700"><li><cite><ahref="https://prometheus.io/"target="_blank"rel="noopenernoreferrer">Prometheus官方文档</a></cite></li><li><cite><ahref="https://doris.apache.org/"target="_blank"rel="noopenernoreferrer">ApacheDoris官方文档</a></cite></li><li><cite><ahref="https://prometheus.io/docs/concepts/metric_types/#histogram"target="_blank"rel="noopenernoreferrer">PrometheusHistogram指标类型说明</a></cite></li><li><cite><ahref="https://prometheus.io/docs/practices/instrumentation/#avoid-missing-metrics"target="_blank"rel="noopenernoreferrer">避免缺失指标的最佳实践</a></cite></li></ol></div></section><footerclass="footer">CreatedbyAutobots<br>页面内容均由AI生成，仅供参考</footer><script>//为图表添加交互提示（简化版）document.addEventListener('DOMContentLoaded',function(){constsvg=document.querySelector('svg');if(svg){svg.addEventListener('mousemove',function(e){constrect=svg.getBoundingClientRect();constx=e.clientX-rect.left;consty=e.clientY-rect.top;//简单的坐标映射，仅用于演示constpoints=[{x:0,y:250,value:'1.47',time:'17:28'},{x:133.3,y:240,value:'1.38',time:'17:29'},{x:266.6,y:235,value:'1.33',time:'17:30'},{x:400,y:270,value:'0.76',time:'17:31'},{x:533.3,y:100,value:'4.67',time:'17:32'},{x:666.6,y:220,value:'1.87',time:'17:33'},{x:800,y:220,value:'1.87',time:'17:34'}];letclosest=points[0];letminDist=Infinity;points.forEach(point=>{constdist=Math.sqrt(Math.pow(x-point.x,2)+Math.pow(y-point.y,2));if(dist<minDist){minDist=dist;closest=point;}});if(minDist<20){consttooltip=document.createElement('div');tooltip.style.position='absolute';tooltip.style.backgroundColor='rgba(0,0,0,0.8)';tooltip.style.color='white';tooltip.style.padding='4px8px';tooltip.style.borderRadius='4px';tooltip.style.fontSize='12px';tooltip.style.pointerEvents='none';tooltip.style.zIndex='1000';tooltip.style.left=(e.clientX+10)+'px';tooltip.style.top=(e.clientY-30)+'px';tooltip.innerHTML=`<strong>QPS:</strong>${closest.value}<br><strong>时间:</strong>${closest.time}`;document.body.appendChild(tooltip);svg.addEventListener('mouseleave',function(){tooltip.remove();});}});}});</script></body></html>