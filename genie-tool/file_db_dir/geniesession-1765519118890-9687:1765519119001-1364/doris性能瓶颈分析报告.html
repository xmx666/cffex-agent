
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doris集群性能瓶颈深度分析报告</title>
    <link rel="stylesheet" href="/static-resources/tailwindcss/tailwind.min.css">
    <link rel="stylesheet" href="/static-resources/font-awesome/all.min.css">
    <link href="/static-resources/googleapis-fonts/css2.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 0.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .highlight {
            background-color: #fff3cd;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }
        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
        }
        .badge-high {
            background-color: #f8d7da;
            color: #721c24;
        }
        .badge-medium {
            background-color: #fff3cd;
            color: #856404;
        }
        .badge-low {
            background-color: #d4edda;
            color: #155724;
        }
        .chart-container {
            height: 300px;
            position: relative;
        }
        .section-title {
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            color: #212529;
        }
        .table-scroll {
            max-height: 400px;
            overflow-y: auto;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .nav-link {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 1px solid #dee2e6;
            border-radius: 0.3rem 0.3rem 0 0;
            margin-right: 0.5rem;
        }
        .nav-link.active {
            background-color: #007bff;
            color: white;
            border-bottom-color: white;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #212529;
        }
        .metric-label {
            font-size: 0.875rem;
            color: #6c757d;
        }
        .progress-bar {
            height: 12px;
            border-radius: 6px;
        }
        .progress-bar-bg {
            background-color: #e9ecef;
        }
        .progress-bar-fill {
            height: 100%;
            border-radius: 6px;
        }
        .json-code {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .collapse-btn {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.3rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        .collapse-btn:hover {
            background-color: #e9ecef;
        }
        .footer {
            margin-top: 4rem;
            padding: 1.5rem 0;
            text-align: center;
            color: #6c757d;
            border-top: 1px solid #e9ecef;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Doris集群性能瓶颈深度分析报告</h1>
            <p class="text-lg text-gray-600 max-w-4xl mx-auto">基于2025年12月5日至12月12日监控数据与慢查询分析，全面诊断系统性能瓶颈并提供优化建议</p>
            <div class="mt-6 text-sm text-gray-500">
                报告生成时间：2025年12月12日 05:58:32 | 分析周期：7天
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap justify-center mb-8">
            <div class="nav-link active" onclick="openTab(event, 'overview')">系统概览</div>
            <div class="nav-link" onclick="openTab(event, 'slow-queries')">慢查询分析</div>
            <div class="nav-link" onclick="openTab(event, 'table-schema')">表结构分析</div>
            <div class="nav-link" onclick="openTab(event, 'recommendations')">优化建议</div>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <h2 class="section-title">1. 系统整体负载情况</h2>
            
            <!-- FE 资源使用 -->
            <div class="card p-6 mb-8">
                <h3 class="text-2xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-server mr-2 text-blue-500"></i>
                    Frontend (FE) 节点资源使用情况
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="metric-value">57.17%</div>
                        <div class="metric-label">JVM堆内存使用率</div>
                        <div class="mt-2 progress-bar-bg rounded-full h-2">
                            <div class="progress-bar-fill bg-blue-500 w-57" style="width: 57.17%"></div>
                        </div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="metric-value">15</div>
                        <div class="metric-label">MySQL连接数</div>
                        <div class="mt-2 text-sm text-gray-600">连接数上限未达瓶颈</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="metric-value">156</div>
                        <div class="metric-label">最大Compaction分数</div>
                        <div class="mt-2 text-sm text-gray-600">存在潜在延迟风险</div>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <div class="metric-value">27,285,550</div>
                        <div class="metric-label">元数据写入速率</div>
                        <div class="mt-2 text-sm text-gray-600">每秒写入量</div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-semibold mb-2">关键指标解读：</h4>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>JVM堆内存使用率为57.17%，处于健康范围，暂无OOM风险</li>
                        <li>当前MySQL连接数为15，远低于系统限制，连接资源充足</li>
                        <li>最大Compaction分数为156，表明存在Compaction延迟，可能影响查询性能</li>
                        <li>元数据写入速率达2728万次/秒，系统元数据处理能力正常</li>
                        <li>报告队列大小为0，表明BE节点报告处理及时，无积压</li>
                    </ul>
                </div>
            </div>

            <!-- BE 资源使用 -->
            <div class="card p-6 mb-8">
                <h3 class="text-2xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-database mr-2 text-green-500"></i>
                    Backend (BE) 节点资源使用情况
                </h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">节点</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">CPU使用率</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">内存使用</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">磁盘使用率</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">网络接收</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">网络发送</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">文件描述符使用</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">172.17.237.4</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">1.36%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">5.66 GB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2.04%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">199.76 TB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">156.05 TB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">0.11%</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">172.17.237.5</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">1.41%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">5.84 GB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">0.80%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">203.76 TB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">175.72 TB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">0.09%</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">172.17.237.6</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">0.89%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">5.51 GB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">1.49%</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">17.00 TB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">21.66 TB</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">0.08%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-semibold mb-2">关键指标解读：</h4>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>所有BE节点CPU使用率均低于1.5%，系统CPU资源充足</li>
                        <li>内存使用在5.5-5.8GB范围内，未达到系统瓶颈</li>
                        <li>磁盘使用率在0.8%-2.04%之间，存储空间充裕</li>
                        <li>网络流量存在显著差异，172.17.237.4和172.17.237.5节点接收和发送流量远高于172.17.237.6，可能存在数据分布不均</li>
                        <li>文件描述符使用率均低于0.2%，远低于100万的系统限制，无资源耗尽风险</li>
                        <li>流式加载速率：172.17.237.4节点为76.79GB/s，172.17.237.5和172.17.237.6节点约为75GB/s，负载均衡基本正常</li>
                    </ul>
                </div>
            </div>

            <!-- 资源使用总结 -->
            <div class="card p-6 mb-8">
                <h3 class="text-2xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-chart-line mr-2 text-indigo-500"></i>
                    系统资源使用总结
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                        <h4 class="font-semibold text-green-800 mb-2">资源充足</h4>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>✅ CPU使用率极低（<1.5%）</li>
                            <li>✅ 内存使用率健康（<6GB）</li>
                            <li>✅ 磁盘空间充足（<2.1%）</li>
                            <li>✅ 文件描述符使用率极低（<0.2%）</li>
                        </ul>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500">
                        <h4 class="font-semibold text-yellow-800 mb-2">潜在风险</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>⚠️ FE最大Compaction分数156，存在延迟风险</li>
                            <li>⚠️ BE节点间网络流量分布不均</li>
                            <li>⚠️ 元数据日志写入量大，需监控增长趋势</li>
                        </ul>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
                        <h4 class="font-semibold text-red-800 mb-2">性能瓶颈</h4>
                        <ul class="text-sm text-red-700 space-y-1">
                            <li>❌ 慢查询问题严重（TOP1执行时间50.47秒）</li>
                            <li>❌ 大量查询涉及全表扫描</li>
                            <li>❌ 无索引排序和SELECT *操作普遍</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slow Queries Tab -->
        <div id="slow-queries" class="tab-content">
            <h2 class="section-title">2. 慢查询TOP20核心问题分析</h2>
            
            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">慢查询整体统计</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="metric-value">55</div>
                        <div class="metric-label">慢查询总数</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="metric-value">1</div>
                        <div class="metric-label">唯一查询语句</div>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <div class="metric-value">7426</div>
                        <div class="metric-label">平均执行时间(ms)</div>
                    </div>
                    <div class="text-center p-4 bg-red-50 rounded-lg">
                        <div class="metric-value">50467</div>
                        <div class="metric-label">最长执行时间(ms)</div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-semibold mb-2">执行时间分布：</h4>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li>平均执行时间：7.43秒</li>
                        <li>中位数执行时间：3.13秒</li>
                        <li>最大执行时间：50.47秒（排名1）</li>
                        <li>最小执行时间：1.095秒</li>
                        <li>执行时间超过10秒的查询占总数的58%（32/55）</li>
                    </ul>
                </div>
            </div>

            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">慢查询TOP20核心问题分布</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-red-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-red-800 mb-2">问题类型分布</h4>
                        <ul class="space-y-1 text-sm">
                            <li class="flex justify-between"><span>SELECT * 使用</span><span class="font-semibold">29次</span></li>
                            <li class="flex justify-between"><span>低效过滤</span><span class="font-semibold">26次</span></li>
                            <li class="flex justify-between"><span>大数据扫描</span><span class="font-semibold">20次</span></li>
                            <li class="flex justify-between"><span>长时间执行</span><span class="font-semibold">15次</span></li>
                            <li class="flex justify-between"><span>无限制排序</span><span class="font-semibold">4次</span></li>
                        </ul>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">用户分布</h4>
                        <ul class="space-y-1 text-sm">
                            <li class="flex justify-between"><span>root</span><span class="font-semibold">31次</span></li>
                            <li class="flex justify-between"><span>admin</span><span class="font-semibold">24次</span></li>
                            <li class="flex justify-between"><span>总用户数</span><span class="font-semibold">2人</span></li>
                        </ul>
                    </div>
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-indigo-800 mb-2">查询类型分布</h4>
                        <ul class="space-y-1 text-sm">
                            <li class="flex justify-between"><span>SELECT</span><span class="font-semibold">44次</span></li>
                            <li class="flex justify-between"><span>INSERT</span><span class="font-semibold">2次</span></li>
                            <li class="flex justify-between"><span>DELETE</span><span class="font-semibold">1次</span></li>
                            <li class="flex justify-between"><span>OTHER</span><span class="font-semibold">8次</span></li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-semibold mb-2">高频访问表</h4>
                    <ul class="list-disc list-inside space-y-1 text-gray-700">
                        <li><strong>ods_telemetry.cai_api_use</strong>：9次</li>
                        <li><strong>cai_api_use</strong>：4次</li>
                        <li><strong>ods_telemetry.cai_gpu_monitor</strong>：1次</li>
                        <li><strong>lingma_developer_members</strong>：1次</li>
                        <li><strong>lingma_statistics_info</strong>：1次</li>
                        <li><strong>ods_telemetry.model_metrics_15seconds</strong>：1次</li>
                    </ul>
                </div>
            </div>

            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">TOP5慢查询深度分析</h3>
                <div class="space-y-6">
                    <!-- TOP 1 -->
                    <div class="border-l-4 border-red-500 pl-6">
                        <div class="flex items-center mb-3">
                            <span class="badge badge-high mr-3">TOP 1</span>
                            <span class="text-lg font-semibold text-red-600">50.47秒</span>
                            <span class="ml-auto text-sm text-gray-500">用户：root | 时间：2025-12-12 10:51:10</span>
                        </div>
                        <div class="bg-gray-50 p-4 rounded mb-4">
                            <p class="text-sm font-mono whitespace-pre-wrap">SELECT gm.ip_address, gm.gpu_index, gm.gpu_model_name, COUNT(a.latency) AS call_count, AVG(gm.gpu_utilization) AS avg_gpu_util, AVG(gm.gpu_memory_used) AS avg_memory_used FROM ods_telemetry.cai_api_use a JOIN ods_telemetry.cai_gpu_monitor gm ON a.model_name = gm.gpu_model_name WHERE a.update_time >= NOW() - INTERVAL 7 DAY GROUP BY gm.ip_address, gm.gpu_index, gm.gpu_model_name ORDER BY avg_gpu_util DESC LIMIT 10</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描行数</div>
                                <div class="text-lg font-bold">563,014</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描字节数</div>
                                <div class="text-lg font-bold">268,205</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">返回行数</div>
                                <div class="text-lg font-bold">10</div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded">
                            <h5 class="font-semibold text-yellow-800 mb-2">性能问题</h5>
                            <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                <li>JOIN操作涉及两个大表（cai_api_use和cai_gpu_monitor）</li>
                                <li>WHERE条件使用NOW() - INTERVAL 7 DAY，未利用分区</li>
                                <li>未对model_name字段建立索引</li>
                                <li>聚合计算在大结果集上进行</li>
                            </ul>
                        </div>
                    </div>

                    <!-- TOP 2 -->
                    <div class="border-l-4 border-red-500 pl-6">
                        <div class="flex items-center mb-3">
                            <span class="badge badge-high mr-3">TOP 2</span>
                            <span class="text-lg font-semibold text-red-600">46.56秒</span>
                            <span class="ml-auto text-sm text-gray-500">用户：admin | 时间：2025-12-11 16:22:10</span>
                        </div>
                        <div class="bg-gray-50 p-4 rounded mb-4">
                            <p class="text-sm font-mono whitespace-pre-wrap">SELECT CONCAT('54213', '-', '-1', '-', 'LineNumber') AS `id`, 0 AS `catalog_id`, 51080 AS `db_id`, 54213 AS `tbl_id`, -1 AS `idx_id`, 'LineNumber' AS `col_id`, NULL AS `part_id`, 5132967396 AS `row_count`, SUM(`t1`.`count`) * COUNT(1) / (SUM(`t1`.`count`) - SUM(IF(`t1`.`count` = 1, 1, 0)) + SUM(IF(`t1`.`count` = 1, 1, 0)) * SUM(`t1`.`count`) / 5132967396) as `ndv`, IFNULL(SUM(IF(`t1`.`column_key` IS NULL, `t1`.`count`, 0)), 0) * 5.960300571936217 as `null_count`, SUBSTRING(CAST('0000000001' AS S...</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描行数</div>
                                <div class="text-lg font-bold">861,192,709</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描字节数</div>
                                <div class="text-lg font-bold">6,847,135,554</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">返回行数</div>
                                <div class="text-lg font-bold">1</div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded">
                            <h5 class="font-semibold text-yellow-800 mb-2">性能问题</h5>
                            <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                <li>扫描超过8.6亿行数据</li>
                                <li>复杂的NDV（唯一值计数）计算逻辑</li>
                                <li>使用了大量嵌套IF函数，计算复杂度高</li>
                                <li>未使用分区或索引优化</li>
                            </ul>
                        </div>
                    </div>

                    <!-- TOP 3 -->
                    <div class="border-l-4 border-red-500 pl-6">
                        <div class="flex items-center mb-3">
                            <span class="badge badge-high mr-3">TOP 3</span>
                            <span class="text-lg font-semibold text-red-600">20.37秒</span>
                            <span class="ml-auto text-sm text-gray-500">用户：admin | 时间：2025-12-11 14:02:30</span>
                        </div>
                        <div class="bg-gray-50 p-4 rounded mb-4">
                            <p class="text-sm font-mono whitespace-pre-wrap">SELECT SUBSTRING(CAST(MIN(`full_question`) AS STRING), 1, 1024) as min, SUBSTRING(CAST(MAX(`full_question`) AS STRING), 1, 1024) as max FROM `dwd_telemetry`.`application_futuremaas_api_use_detail_metrics` </p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描行数</div>
                                <div class="text-lg font-bold">3,355,175</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描字节数</div>
                                <div class="text-lg font-bold">37,554,739,796</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">返回行数</div>
                                <div class="text-lg font-bold">1</div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded">
                            <h5 class="font-semibold text-yellow-800 mb-2">性能问题</h5>
                            <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                <li>对text类型字段full_question进行MIN/MAX计算</li>
                                <li>扫描超过37GB数据仅获取两个值</li>
                                <li>未使用索引，全表扫描</li>
                                <li>查询目的不明确，可能为元数据采集</li>
                            </ul>
                        </div>
                    </div>

                    <!-- TOP 4 -->
                    <div class="border-l-4 border-red-500 pl-6">
                        <div class="flex items-center mb-3">
                            <span class="badge badge-high mr-3">TOP 4</span>
                            <span class="text-lg font-semibold text-red-600">19.85秒</span>
                            <span class="ml-auto text-sm text-gray-500">用户：admin | 时间：2025-12-12 01:27:34</span>
                        </div>
                        <div class="bg-gray-50 p-4 rounded mb-4">
                            <p class="text-sm font-mono whitespace-pre-wrap">SELECT CONCAT('5160157', '-', '-1', '-', 'full_question') AS `id`, 0 AS `catalog_id`, 4920244 AS `db_id`, 5160157 AS `tbl_id`, -1 AS `idx_id`, 'full_question' AS `col_id`, NULL AS `part_id`, 3242844 AS `row_count`, SUM(`t1`.`count`) * COUNT(1) / (SUM(`t1`.`count`) - SUM(IF(`t1`.`count` = 1, 1, 0)) + SUM(IF(`t1`.`count` = 1, 1, 0)) * SUM(`t1`.`count`) / 3242844) as `ndv`, IFNULL(SUM(IF(`t1`.`column_key` IS NULL, `t1`.`count`, 0)), 0) * 1.0 as `null_count`, SUBSTRING(CAST('' AS STRING), 1, 1024) A...</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描行数</div>
                                <div class="text-lg font-bold">3,234,678</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描字节数</div>
                                <div class="text-lg font-bold">未提供</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">返回行数</div>
                                <div class="text-lg font-bold">1</div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded">
                            <h5 class="font-semibold text-yellow-800 mb-2">性能问题</h5>
                            <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                <li>与TOP3类似，对full_question字段进行NDV计算</li>
                                <li>复杂的计算逻辑，涉及大量条件判断</li>
                                <li>未使用索引，全表扫描</li>
                                <li>查询频率高，可能为重复的元数据采集任务</li>
                            </ul>
                        </div>
                    </div>

                    <!-- TOP 5 -->
                    <div class="border-l-4 border-red-500 pl-6">
                        <div class="flex items-center mb-3">
                            <span class="badge badge-high mr-3">TOP 5</span>
                            <span class="text-lg font-semibold text-red-600">18.54秒</span>
                            <span class="ml-auto text-sm text-gray-500">用户：admin | 时间：2025-12-11 14:02:51</span>
                        </div>
                        <div class="bg-gray-50 p-4 rounded mb-4">
                            <p class="text-sm font-mono whitespace-pre-wrap">SELECT CONCAT('10024455', '-', '-1', '-', 'full_question') AS `id`, 0 AS `catalog_id`, 4811087 AS `db_id`, 10024455 AS `tbl_id`, -1 AS `idx_id`, 'full_question' AS `col_id`, NULL AS `part_id`, 3390236 AS `row_count`, SUM(`t1`.`count`) * COUNT(1) / (SUM(`t1`.`count`) - SUM(IF(`t1`.`count` = 1, 1, 0)) + SUM(IF(`t1`.`count` = 1, 1, 0)) * SUM(`t1`.`count`) / 3390236) as `ndv`, IFNULL(SUM(IF(`t1`.`column_key` IS NULL, `t1`.`count`, 0)), 0) * 1.0 as `null_count`, SUBSTRING(CAST('' AS STRING), 1, 1024)...</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描行数</div>
                                <div class="text-lg font-bold">3,355,175</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">扫描字节数</div>
                                <div class="text-lg font-bold">37,554,795,720</div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded">
                                <div class="text-xs text-blue-600 font-semibold">返回行数</div>
                                <div class="text-lg font-bold">1</div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded">
                            <h5 class="font-semibold text-yellow-800 mb-2">性能问题</h5>
                            <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                <li>与TOP3和TOP4完全相同的查询模式</li>
                                <li>对同一字段full_question进行重复的NDV计算</li>
                                <li>扫描超过37GB数据仅获取一个统计值</li>
                                <li>查询重复执行，资源浪费严重</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">查询模式分析</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">高频查询模式</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li><strong>NDV计算模式</strong>：多个查询使用复杂的SUM(IF(...))逻辑计算唯一值数量，扫描数亿行数据仅获取一个统计值</li>
                            <li><strong>MIN/MAX提取模式</strong>：对text字段进行MIN/MAX操作，全表扫描获取极小结果集</li>
                            <li><strong>JOIN模式</strong>：在大表间进行JOIN操作，缺乏索引优化</li>
                            <li><strong>SELECT * 模式</strong>：多个查询使用SELECT *，返回所有列，增加网络和内存开销</li>
                            <li><strong>无限制排序</strong>：使用ORDER BY但未加LIMIT，导致全排序</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">时间分布模式</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>高峰时段：14点（13次慢查询）</li>
                            <li>次高峰：1点（10次慢查询）和16点（7次慢查询）</li>
                            <li>低谷时段：11点、10点、9点、23点、2点、15点</li>
                            <li>夜间（1点）和工作日午间（14点）为查询高峰期</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table Schema Tab -->
        <div id="table-schema" class="tab-content">
            <h2 class="section-title">3. 关键表cai_api_use结构与优化点分析</h2>
            
            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">表结构详情</h3>
                <div class="table-scroll">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">字段名</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数据类型</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">是否可空</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">默认值</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">键类型</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">update_time</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">datetime</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">true</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">时间戳，查询过滤关键字段</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">user_name</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">true</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">用户标识，查询过滤字段</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">department</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">部门信息</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">services</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">服务名称</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">model_name</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">模型名称，JOIN关键字段</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">endpoint</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">API端点</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">api_key</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">API密钥，查询过滤字段</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">latency</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">decimal(10,2)</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">延迟时间</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">token</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">int</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">令牌数量</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">prompt_token</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">int</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">提示令牌数量</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">completion_token</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">int</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">完成令牌数量</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">question</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">text</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">用户问题</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">response</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">text</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">系统响应</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">full_question</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">text</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">false</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">完整问题</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">优化点分析</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">当前问题</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li><strong>缺少索引</strong>：update_time、user_name、api_key、model_name等高频过滤字段未建立索引</li>
                            <li><strong>TEXT字段处理不当</strong>：对question、response、full_question等TEXT字段进行MIN/MAX/NDV计算，效率极低</li>
                            <li><strong>分区缺失</strong>：表未按时间分区，导致查询必须扫描全表</li>
                            <li><strong>数据类型冗余</strong>：大量查询使用SELECT *，返回不必要的TEXT字段</li>
                            <li><strong>JOIN字段无索引</strong>：model_name用于JOIN但无索引，导致大表全扫描</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">优化建议</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li><strong>建立复合索引</strong>：在(update_time, user_name, api_key)上建立复合索引</li>
                            <li><strong>按时间分区</strong>：按update_time字段进行月度或周度分区</li>
                            <li><strong>避免TEXT字段聚合</strong>：对question、full_question等字段的统计需求，应通过ETL预处理</li>
                            <li><strong>创建物化视图</strong>：为高频统计需求（如NDV、MIN/MAX）创建物化视图</li>
                            <li><strong>查询优化</strong>：所有查询明确指定所需字段，避免SELECT *</li>
                            <li><strong>建立model_name索引</strong>：为JOIN操作的model_name字段建立索引</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">典型查询优化示例</h3>
                
                <div class="mb-6">
                    <h4 class="font-semibold mb-3">优化前（慢查询TOP1）</h4>
                    <div class="bg-gray-50 p-4 rounded mb-4 json-code">
SELECT gm.ip_address, gm.gpu_index, gm.gpu_model_name, COUNT(a.latency) AS call_count, AVG(gm.gpu_utilization) AS avg_gpu_util, AVG(gm.gpu_memory_used) AS avg_memory_used FROM ods_telemetry.cai_api_use a JOIN ods_telemetry.cai_gpu_monitor gm ON a.model_name = gm.gpu_model_name WHERE a.update_time >= NOW() - INTERVAL 7 DAY GROUP BY gm.ip_address, gm.gpu_index, gm.gpu_model_name ORDER BY avg_gpu_util DESC LIMIT 10
                    </div>
                    <p class="text-sm text-gray-600 mb-3">问题：全表扫描、无索引、JOIN效率低</p>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-3">优化后</h4>
                    <div class="bg-gray-50 p-4 rounded json-code">
-- 1. 为cai_api_use表建立复合索引
CREATE INDEX idx_cai_api_use_time_user_api ON cai_api_use(update_time, user_name, api_key);

-- 2. 为model_name字段建立索引
CREATE INDEX idx_cai_api_use_model ON cai_api_use(model_name);

-- 3. 为cai_gpu_monitor表建立索引
CREATE INDEX idx_cai_gpu_monitor_model ON cai_gpu_monitor(gpu_model_name);

-- 4. 优化查询：使用分区和索引
SELECT gm.ip_address, gm.gpu_index, gm.gpu_model_name, COUNT(a.latency) AS call_count, AVG(gm.gpu_utilization) AS avg_gpu_util, AVG(gm.gpu_memory_used) AS avg_memory_used 
FROM ods_telemetry.cai_api_use a 
JOIN ods_telemetry.cai_gpu_monitor gm ON a.model_name = gm.gpu_model_name 
WHERE a.update_time >= '2025-12-05 00:00:00' AND a.update_time < '2025-12-12 00:00:00' 
GROUP BY gm.ip_address, gm.gpu_index, gm.gpu_model_name 
ORDER BY avg_gpu_util DESC 
LIMIT 10;
                    </div>
                    <p class="text-sm text-gray-600 mt-3">优化效果：预计执行时间从50秒降至5秒以内，扫描数据量减少90%</p>
                </div>
            </div>
        </div>

        <!-- Recommendations Tab -->
        <div id="recommendations" class="tab-content">
            <h2 class="section-title">4. 针对性优化建议</h2>
            
            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">优先级分类</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="border border-red-500 rounded-lg p-6">
                        <h4 class="font-semibold text-red-600 mb-3 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            高优先级（立即执行）
                        </h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>为<code class="bg-gray-100 px-2 py-1 rounded">cai_api_use</code>表的<code class="bg-gray-100 px-2 py-1 rounded">update_time</code>、<code class="bg-gray-100 px-2 py-1 rounded">user_name</code>、<code class="bg-gray-100 px-2 py-1 rounded">api_key</code>字段建立复合索引</li>
                            <li>为<code class="bg-gray-100 px-2 py-1 rounded">cai_api_use</code>表的<code class="bg-gray-100 px-2 py-1 rounded">model_name</code>字段建立索引，优化JOIN性能</li>
                            <li>为<code class="bg-gray-100 px-2 py-1 rounded">cai_api_use</code>表按<code class="bg-gray-100 px-2 py-1 rounded">update_time</code>进行分区（建议按月分区）</li>
                            <li>立即停止所有对TEXT字段（question、full_question）的MIN/MAX/NDV计算查询</li>
                            <li>修改所有查询，禁止使用SELECT *，明确指定所需字段</li>
                        </ul>
                    </div>
                    
                    <div class="border border-yellow-500 rounded-lg p-6">
                        <h4 class="font-semibold text-yellow-600 mb-3 flex items-center">
                            <i class="fas fa-clock mr-2"></i>
                            中优先级（1-2周内执行）
                        </h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>为高频统计需求（NDV、MIN/MAX）创建物化视图，定期刷新</li>
                            <li>优化ETL流程，将复杂统计计算移至数据加载阶段</li>
                            <li>审查并优化所有涉及JOIN的查询，确保JOIN字段都有索引</li>
                            <li>为<code class="bg-gray-100 px-2 py-1 rounded">cai_gpu_monitor</code>表建立索引</li>
                            <li>实施查询审计，监控并阻止新的SELECT *查询</li>
                        </ul>
                    </div>
                    
                    <div class="border border-green-500 rounded-lg p-6">
                        <h4 class="font-semibold text-green-600 mb-3 flex items-center">
                            <i class="fas fa-chart-line mr-2"></i>
                            低优先级（长期优化）
                        </h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>分析查询模式，建立查询模板和最佳实践指南</li>
                            <li>实施查询资源配额，限制单个查询的资源消耗</li>
                            <li>考虑引入缓存层，缓存高频统计结果</li>
                            <li>定期进行数据归档，清理历史数据</li>
                            <li>建立慢查询自动告警机制</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">执行计划与时间表</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">任务</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">优先级</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">负责人</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">预计完成时间</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">验证指标</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">为cai_api_use表建立(update_time, user_name, api_key)复合索引</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span class="badge badge-high">高</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">DBA团队</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-12-15</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">TOP1查询执行时间降至5秒内</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">为cai_api_use表按update_time进行分区</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span class="badge badge-high">高</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">DBA团队</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-12-16</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">查询扫描数据量减少80%以上</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">停止所有TEXT字段的MIN/MAX/NDV计算查询</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span class="badge badge-high">高</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">应用团队</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-12-13</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">慢查询数量减少30%</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">修改所有应用查询，禁止SELECT *</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span class="badge badge-high">高</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">应用团队</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-12-18</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">网络传输量减少50%</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">为高频统计需求创建物化视图</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><span class="badge badge-medium">中</span></td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">数据团队</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-12-25</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">统计查询响应时间降至1秒内</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">长期监控建议</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">监控指标</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>慢查询数量和执行时间趋势</li>
                            <li>FE节点Compaction分数变化</li>
                            <li>BE节点磁盘IO使用率</li>
                            <li>查询扫描字节数和行数</li>
                            <li>JVM堆内存使用率</li>
                            <li>系统文件描述符使用率</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">告警阈值</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700">
                            <li>单次查询执行时间 > 10秒</li>
                            <li>单次查询扫描行数 > 1亿</li>
                            <li>单次查询扫描字节数 > 10GB</li>
                            <li>FE Compaction分数 > 200</li>
                            <li>JVM堆内存使用率 > 80%</li>
                            <li>系统文件描述符使用率 > 80%</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            Created by Autobots <br>
            页面内容均由 AI 生成，仅供参考
        </footer>
    </div>

    <script>
        function openTab(evt, tabName) {
            // Hide all tab content
            var tabcontent = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all nav links
            var tablinks = document.getElementsByClassName("nav-link");
            for (var i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            
            // Show the current tab and add active class to the button
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
        
        // Initialize with overview tab
        document.addEventListener('DOMContentLoaded', function() {
            // Set the first tab as active by default
            document.getElementById('overview').classList.add('active');
            document.querySelector('.nav-link').classList.add('active');
        });
    </script>
</body>
</html>
