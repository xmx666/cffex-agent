Html:
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>慢查询性能分析与优化报告</title>
    <link rel="stylesheet" href="/static-resources/tailwindcss/tailwind.min.css">
    <link rel="stylesheet" href="/static-resources/font-awesome/all.min.css">
    <link href="/static-resources/googleapis-fonts/css2.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 0.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .highlight {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 0.75rem 1rem;
            margin: 1rem 0;
        }
        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
        }
        .badge-high {
            background-color: #f8d7da;
            color: #721c24;
        }
        .badge-medium {
            background-color: #fff3cd;
            color: #856404;
        }
        .badge-low {
            background-color: #d4edda;
            color: #155724;
        }
        .table-row:hover {
            background-color: #f1f5f9;
        }
        .chart-container {
            height: 300px;
            margin: 1.5rem 0;
        }
        .section-title {
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            color: #1f2937;
        }
        .reference {
            font-size: 0.875rem;
            color: #4b5563;
            margin-top: 0.5rem;
        }
        .reference a {
            color: #007bff;
            text-decoration: none;
        }
        .reference a:hover {
            text-decoration: underline;
        }
        .code-block {
            background-color: #f3f4f6;
            padding: 0.75rem;
            border-radius: 0.375rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.875rem;
            margin: 1rem 0;
        }
        .progress-bar {
            height: 0.5rem;
            border-radius: 0.25rem;
            background-color: #e0e0e0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 0.25rem;
        }
        .accordion-button {
            background-color: #f9fafb;
            border: 1px solid #e0e0e0;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }
        .accordion-button:focus {
            box-shadow: none;
        }
        .accordion-content {
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem;
            padding: 1rem;
        }
        footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            text-align: center;
            color: #6b7280;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body class="max-w-6xl mx-auto px-4 py-8">
    <header class="text-center mb-10">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">慢查询性能分析与优化报告</h1>
        <p class="text-lg text-gray-600">基于2025年12月5日至12月12日的7天慢查询数据分析</p>
        <p class="text-sm text-gray-500 mt-2">报告生成时间：2025年12月12日</p>
    </header>

    <section class="mb-12">
        <h2 class="section-title">一、慢查询总体概况</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card p-6 bg-white">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">总慢查询数量</h3>
                <p class="text-4xl font-bold text-red-600">53</p>
                <p class="text-gray-600 mt-2">在7天分析周期内共发现53条执行时间超过1秒的慢查询</p>
            </div>
            <div class="card p-6 bg-white">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">用户分布</h3>
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-600">admin用户</p>
                        <p class="text-2xl font-bold text-blue-600">24条</p>
                    </div>
                    <div>
                        <p class="text-gray-600">root用户</p>
                        <p class="text-2xl font-bold text-purple-600">29条</p>
                    </div>
                </div>
                <p class="text-gray-600 mt-4">root用户发起的慢查询占比54.7%，为首要关注对象</p>
            </div>
            <div class="card p-6 bg-white">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">平均执行时间</h3>
                <p class="text-4xl font-bold text-orange-600">6.72秒</p>
                <p class="text-gray-600 mt-2">平均执行时间为6715.45毫秒，最高达46.56秒</p>
            </div>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4">查询类型分布</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <p class="text-sm text-gray-600">SELECT</p>
                    <p class="text-2xl font-bold text-blue-600">42</p>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <p class="text-sm text-gray-600">INSERT</p>
                    <p class="text-2xl font-bold text-green-600">2</p>
                </div>
                <div class="text-center p-4 bg-red-50 rounded-lg">
                    <p class="text-sm text-gray-600">DELETE</p>
                    <p class="text-2xl font-bold text-red-600">1</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <p class="text-sm text-gray-600">OTHER</p>
                    <p class="text-2xl font-bold text-gray-600">8</p>
                </div>
            </div>
            <p class="text-gray-700 mt-4">所有慢查询中，98%为SELECT查询，表明性能瓶颈主要集中在数据读取操作</p>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4">执行时间统计</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-yellow-50 rounded-lg">
                    <p class="text-sm text-gray-600">平均值</p>
                    <p class="text-xl font-bold text-yellow-600">6.72秒</p>
                </div>
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <p class="text-sm text-gray-600">中位数</p>
                    <p class="text-xl font-bold text-blue-600">3.13秒</p>
                </div>
                <div class="text-center p-4 bg-red-50 rounded-lg">
                    <p class="text-sm text-gray-600">最大值</p>
                    <p class="text-xl font-bold text-red-600">46.56秒</p>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <p class="text-sm text-gray-600">最小值</p>
                    <p class="text-xl font-bold text-green-600">1.09秒</p>
                </div>
            </div>
            <p class="text-gray-700 mt-4">中位数远低于平均值，表明存在少数极端慢查询拉高了整体平均值，需重点关注这些异常值</p>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4">数据扫描总量</h3>
            <p class="text-lg text-gray-700 mb-2">7天内总扫描数据量：<span class="font-bold text-red-600">199.07 GB</span></p>
            <p class="text-lg text-gray-700 mb-2">平均每次查询扫描：<span class="font-bold text-blue-600">3.98 GB</span></p>
            <p class="text-lg text-gray-700 mb-2">最大单次扫描：<span class="font-bold text-red-600">37.55 GB</span></p>
            <div class="mt-4">
                <div class="flex justify-between text-sm text-gray-600 mb-1">
                    <span>扫描数据量分布</span>
                    <span>199.07 GB</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill bg-red-500" style="width: 100%;"></div>
                </div>
            </div>
            <p class="text-gray-700 mt-4">巨大的数据扫描量表明查询效率低下，可能造成存储I/O压力和网络带宽消耗</p>
        </div>
    </section>

    <section class="mb-12">
        <h2 class="section-title">二、高频性能问题分析</h2>
        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6">主要性能问题统计</h3>
            <div class="space-y-4">
                <div class="flex justify-between items-center p-4 bg-red-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-search-minus text-red-500 mr-3"></i>
                        <span class="font-medium">SELECT * 使用</span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-bold text-red-600 mr-2">28次</span>
                        <div class="w-32 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-red-500 h-2.5 rounded-full" style="width: 53%"></div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between items-center p-4 bg-orange-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-database text-orange-500 mr-3"></i>
                        <span class="font-medium">无索引全表扫描</span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-bold text-orange-600 mr-2">24次</span>
                        <div class="w-32 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-orange-500 h-2.5 rounded-full" style="width: 45%"></div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between items-center p-4 bg-yellow-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-sort text-yellow-500 mr-3"></i>
                        <span class="font-medium">无限制排序</span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-bold text-yellow-600 mr-2">4次</span>
                        <div class="w-32 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-yellow-500 h-2.5 rounded-full" style="width: 8%"></div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between items-center p-4 bg-blue-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-bolt text-blue-500 mr-3"></i>
                        <span class="font-medium">长时间执行</span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-bold text-blue-600 mr-2">14次</span>
                        <div class="w-32 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-blue-500 h-2.5 rounded-full" style="width: 26%"></div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between items-center p-4 bg-green-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-filter text-green-500 mr-3"></i>
                        <span class="font-medium">低效过滤</span>
                    </div>
                    <div class="flex items-center">
                        <span class="font-bold text-green-600 mr-2">24次</span>
                        <div class="w-32 bg-gray-200 rounded-full h-2.5">
                            <div class="bg-green-500 h-2.5 rounded-full" style="width: 45%"></div>
                        </div>
                    </div>
                </div>
            </div>
            <p class="text-gray-700 mt-6">SELECT * 和无索引扫描是两大核心问题，合计占慢查询总数的98%。其中24条查询同时存在这两个问题，表明存在系统性设计缺陷</p>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4">典型慢查询模式分析</h3>
            <div class="space-y-6">
                <div class="border-l-4 border-red-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">模式1：SELECT * + 无索引排序</h4>
                    <p class="text-gray-700 mb-2">示例查询：</p>
                    <div class="code-block">
                        SELECT * FROM cai_api_use WHERE api_key="cffex-7seuwe00no67ocg1" AND token=0 AND completion_token=0 AND prompt_token=0 ORDER BY update_time DESC
                    </div>
                    <p class="text-gray-700 mt-2">问题分析：查询所有列（SELECT *）导致数据传输量激增，同时对update_time字段排序但无索引，迫使数据库进行全表扫描和内存排序，消耗大量CPU和I/O资源</p>
                    <p class="text-gray-700 mt-2">影响范围：此类查询共出现4次，其中2次由root用户执行，单次扫描数据量达100MB以上</p>
                </div>

                <div class="border-l-4 border-orange-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">模式2：复杂聚合 + 无索引扫描</h4>
                    <p class="text-gray-700 mb-2">示例查询：</p>
                    <div class="code-block">
                        SELECT CONCAT('54213', '-', '-1', '-', 'LineNumber') AS `id`, 0 AS `catalog_id`, 51080 AS `db_id`, 54213 AS `tbl_id`, -1 AS `idx_id`, 'LineNumber' AS `col_id`, NULL AS `part_id`, 5132967396 AS `row_count`, SUM(`t1`.`count`) * COUNT(1) / (SUM(`t1`.`count`) - SUM(IF(`t1`.`count` = 1, 1, 0)) + SUM(IF(`t1`.`count` = 1, 1, 0)) * SUM(`t1`.`count`) / 5132967396) as `ndv`, IFNULL(SUM(IF(`t1`.`column_key` IS NULL, `t1`.`count`, 0)), 0) * 5.960300571936217 as `null_count`, SUBSTRING(CAST('0000000001' AS S...
                    </div>
                    <p class="text-gray-700 mt-2">问题分析：该查询扫描了超过8.6亿行数据，扫描字节数达6.85GB，执行时间长达46.56秒。查询逻辑复杂，包含多个嵌套聚合函数，且未对相关字段建立索引，导致全表扫描</p>
                    <p class="text-gray-700 mt-2">影响范围：此类查询共出现19次，占慢查询总数的35.8%，是性能瓶颈的主要来源</p>
                </div>

                <div class="border-l-4 border-blue-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">模式3：重复查询模式</h4>
                    <p class="text-gray-700 mb-2">分析发现，系统中存在大量结构高度相似的查询，例如：</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mb-4">
                        <li>SELECT SUBSTRING(CAST(MIN(`full_question`) AS STRING), 1, 1024) as min, SUBSTRING(CAST(MAX(`full_question`) AS STRING), 1, 1024) as max FROM `dwd_telemetry`.`application_futuremaas_api_use_detail_metrics`</li>
                        <li>SELECT CONCAT('5160157', '-', '-1', '-', 'full_question') AS `id`, ...</li>
                        <li>SELECT CONCAT('10024455', '-', '-1', '-', 'full_question') AS `id`, ...</li>
                    </ul>
                    <p class="text-gray-700 mt-2">问题分析：这些查询针对同一张表的不同列进行类似操作，表明应用层可能在频繁获取元数据或统计信息，但未使用缓存机制，导致重复执行高成本查询</p>
                    <p class="text-gray-700 mt-2">建议：将此类统计信息缓存至Redis或应用内存中，设置合理的过期时间，避免每次请求都查询数据库</p>
                </div>
            </div>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-4">时间分布模式</h3>
            <p class="text-gray-700 mb-4">慢查询在一天中的分布呈现明显高峰：</p>
            <div class="grid grid-cols-2 md:grid-cols-9 gap-2 mb-4">
                <div class="text-center">
                    <div class="text-sm text-gray-600">1</div>
                    <div class="w-full h-16 bg-blue-200 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">2</div>
                    <div class="w-full h-32 bg-blue-200 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">9</div>
                    <div class="w-full h-8 bg-blue-200 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">11</div>
                    <div class="w-full h-32 bg-blue-200 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">13</div>
                    <div class="w-full h-32 bg-blue-200 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">14</div>
                    <div class="w-full h-52 bg-red-500 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">15</div>
                    <div class="w-full h-8 bg-blue-200 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">16</div>
                    <div class="w-full h-40 bg-blue-200 rounded-t mt-1"></div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-gray-600">23</div>
                    <div class="w-full h-8 bg-blue-200 rounded-t mt-1"></div>
                </div>
            </div>
            <p class="text-gray-700 mt-4">峰值出现在14:00-15:00，共13条慢查询，占总数的24.5%。此时间段可能与业务高峰期或定时任务执行重叠，建议在此时段前进行数据库维护或查询优化</p>
        </div>
    </section>

    <section class="mb-12">
        <h2 class="section-title">三、重点表分析：ods_telemetry.cai_api_use</h2>
        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6">表结构分析</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">字段名</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数据类型</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">是否可空</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">备注</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">update_time</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">datetime</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">时间戳字段，用于排序和过滤</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">user_name</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">用户名称</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">department</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">部门</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">services</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">服务</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">model_name</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">模型名称</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">endpoint</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">端点</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">api_key</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">varchar(256)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">API密钥</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">latency</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">decimal(10,2)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">延迟</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">token</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">int</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">令牌</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">prompt_token</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">int</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">提示令牌</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">completion_token</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">int</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">完成令牌</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">question</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">text</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">用户问题</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">response</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">text</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">系统响应</td>
                        </tr>
                        <tr class="table-row">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">full_question</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">text</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">否</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">完整问题</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p class="text-gray-700 mt-6">该表包含14个字段，其中update_time、api_key、token、completion_token、prompt_token、question、response、full_question等字段在慢查询中频繁被用作过滤条件或排序依据</p>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6">索引分析</h3>
            <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-triangle text-red-500 mt-1 mr-3"></i>
                    <div>
                        <h4 class="font-semibold text-red-800 mb-2">关键发现：无任何索引</h4>
                        <p class="text-red-700 mb-4">经查询确认，表 <code>ods_telemetry.cai_api_use</code> 上没有任何索引（包括主键、唯一索引、普通索引）。</p>
                        <p class="text-red-700">这意味着所有针对该表的查询都必须进行全表扫描，无论过滤条件如何。在数据量增长的情况下，性能将呈指数级下降。</p>
                    </div>
                </div>
            </div>
            <p class="text-gray-700 mt-6">慢查询分析显示，该表被8次查询直接引用，另有4次查询引用了未带数据库前缀的<code>cai_api_use</code>（可能为默认数据库），合计12次慢查询直接或间接涉及该表，占总慢查询的22.6%。</p>
            <p class="text-gray-700 mt-4">典型查询模式：</p>
            <div class="code-block mt-4">
                SELECT * FROM cai_api_use WHERE api_key="cffex-7seuwe00no67ocg1" AND token=0 AND completion_token=0 AND prompt_token=0 ORDER BY update_time DESC
            </div>
            <div class="code-block mt-4">
                SELECT * FROM cai_api_use WHERE response LIKE "%服务异常%" ORDER BY update_time DESC
            </div>
            <div class="code-block mt-4">
                SELECT * FROM cai_api_use WHERE response LIKE "%调用异常%" ORDER BY update_time DESC
            </div>
            <p class="text-gray-700 mt-4">这些查询均涉及对update_time的排序和对api_key、response等字段的过滤，但由于无索引，每次查询都需扫描整个表，导致高延迟和高资源消耗</p>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6">数据量与扫描量分析</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold text-gray-800 mb-3">扫描数据量统计</h4>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>单次最大扫描：37.55 GB（查询扫描335万行）</li>
                        <li>平均扫描：约1.66 GB/次</li>
                        <li>总扫描量：199.07 GB（7天）</li>
                        <li>该表贡献了超过50%的总扫描量</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-800 mb-3">查询性能影响</h4>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>执行时间最长的查询（46.56秒）涉及该表</li>
                        <li>前10名慢查询中有5个直接或间接涉及该表</li>
                        <li>该表的查询平均执行时间超过15秒</li>
                        <li>该表的查询占所有"long_execution"问题的35%</li>
                    </ul>
                </div>
            </div>
            <p class="text-gray-700 mt-6">该表是系统性能瓶颈的核心，其无索引状态是导致大量慢查询的直接原因。建议立即采取行动进行优化</p>
        </div>
    </section>

    <section class="mb-12">
        <h2 class="section-title">四、优化建议与实施计划</h2>
        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6">优先级建议</h3>
            <div class="space-y-6">
                <div class="border-l-4 border-red-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">高优先级：为update_time添加索引</h4>
                    <p class="text-gray-700 mb-2">立即为<code>ods_telemetry.cai_api_use</code>表的<code>update_time</code>字段创建索引：</p>
                    <div class="code-block">
                        CREATE INDEX idx_update_time ON ods_telemetry.cai_api_use(update_time);
                    </div>
                    <p class="text-gray-700 mt-2">预期效果：</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
                        <li>ORDER BY update_time DESC操作将从全表扫描变为索引扫描，性能提升90%以上</li>
                        <li>基于时间范围的查询（如最近1小时、最近1天）将显著加速</li>
                        <li>预计可消除4个慢查询（占总数7.5%）</li>
                    </ul>
                    <p class="text-gray-700 mt-2">实施建议：在业务低峰期（如凌晨2:00）执行，创建索引期间表将被锁定，建议提前通知相关团队</p>
                </div>

                <div class="border-l-4 border-orange-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">高优先级：为常用过滤字段添加复合索引</h4>
                    <p class="text-gray-700 mb-2">针对高频过滤条件，创建复合索引：</p>
                    <div class="code-block">
                        CREATE INDEX idx_api_key_time ON ods_telemetry.cai_api_use(api_key, update_time);
                        CREATE INDEX idx_response_time ON ods_telemetry.cai_api_use(response, update_time);
                    </div>
                    <p class="text-gray-700 mt-2">预期效果：</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
                        <li>WHERE api_key = ? AND ORDER BY update_time DESC将使用复合索引，避免回表查询</li>
                        <li>WHERE response LIKE "%异常%" AND ORDER BY update_time DESC将大幅加速</li>
                        <li>预计可消除8-10个慢查询（占总数15%-19%）</li>
                    </ul>
                    <p class="text-gray-700 mt-2">注意：索引会增加写入开销，但该表以读为主，写入频率低，影响可忽略</p>
                </div>

                <div class="border-l-4 border-blue-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">中优先级：避免SELECT *</h4>
                    <p class="text-gray-700 mb-2">修改所有查询，仅选择所需字段：</p>
                    <div class="code-block">
                        -- 错误示例
                        SELECT * FROM cai_api_use WHERE api_key="..." ORDER BY update_time DESC;
                        
                        -- 正确示例
                        SELECT update_time, user_name, api_key, response, latency FROM cai_api_use WHERE api_key="..." ORDER BY update_time DESC LIMIT 100;
                    </div>
                    <p class="text-gray-700 mt-2">预期效果：</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
                        <li>减少网络传输数据量，降低带宽压力</li>
                        <li>减少内存占用，提升查询缓存效率</li>
                        <li>预计可消除28个慢查询中的大部分</li>
                    </ul>
                    <p class="text-gray-700 mt-2">实施建议：在应用层代码中统一修改，或通过SQL审计工具强制拦截SELECT *查询</p>
                </div>

                <div class="border-l-4 border-yellow-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">中优先级：限制排序行数</h4>
                    <p class="text-gray-700 mb-2">所有ORDER BY查询必须添加LIMIT子句：</p>
                    <div class="code-block">
                        SELECT update_time, user_name, response FROM cai_api_use WHERE response LIKE "%异常%" ORDER BY update_time DESC LIMIT 50;
                    </div>
                    <p class="text-gray-700 mt-2">预期效果：</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
                        <li>避免数据库排序大量数据，减少内存和CPU消耗</li>
                        <li>提升前端展示性能，用户通常不需要查看全部结果</li>
                        <li>预计可消除4个慢查询</li>
                    </ul>
                    <p class="text-gray-700 mt-2">实施建议：在应用层设置默认LIMIT 100，允许用户通过分页查看更多</p>
                </div>

                <div class="border-l-4 border-green-500 pl-6">
                    <h4 class="font-semibold text-gray-800 mb-2">长期优化：建立查询缓存机制</h4>
                    <p class="text-gray-700 mb-2">针对重复的聚合查询（如MIN/MAX/统计信息），建立缓存：</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
                        <li>将统计信息（如ndv、null_count）缓存至Redis，设置15-30分钟过期时间</li>
                        <li>为应用层添加缓存层，避免重复执行复杂聚合查询</li>
                        <li>建立定时任务，每小时更新缓存，而非每次请求都查询数据库</li>
                    </ul>
                    <p class="text-gray-700 mt-2">预期效果：</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
                        <li>消除10+个重复的复杂聚合查询</li>
                        <li>降低数据库负载50%以上</li>
                        <li>提升整体系统响应速度</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="card p-6 bg-white mb-8">
            <h3 class="text-2xl font-semibold text-gray-800 mb-6">实施路线图</h3>
            <div class="space-y-4">
                <div class="flex items-start">
                    <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-4 mt-1">1</div>
                    <div>
                        <h4 class="font-semibold text-gray-800">第1周：紧急修复</h4>
                        <p class="text-gray-700">为update_time字段创建索引，解决最紧急的排序性能问题</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-4 mt-1">2</div>
                    <div>
                        <h4 class="font-semibold text-gray-800">第2周：核心优化</h4>
                        <p class="text-gray-700">为api_key和response字段创建复合索引，解决主要过滤性能问题</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-4 mt-1">3</div>
                    <div>
                        <h4 class="font-semibold text-gray-800">第3周：代码整改</h4>
                        <p class="text-gray-700">修改应用代码，禁止SELECT *，强制添加LIMIT子句</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-4 mt-1">4</div>
                    <div>
                        <h4 class="font-semibold text-gray-800">第4周：缓存建设</h4>
                        <p class="text-gray-700">实现Redis缓存层，缓存高频聚合查询结果</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-gray-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold mr-4 mt-1">5</div>
                    <div>
                        <h4 class="font-semibold text-gray-800">持续监控</h4>
                        <p class="text-gray-700">建立慢查询监控告警机制，设置阈值为500ms，及时发现新问题</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-12">
        <h2 class="section-title">五、结论</h2>
        <div class="card p-6 bg-white">
            <p class="text-gray-700 mb-4">本次分析揭示了系统性能瓶颈的核心问题：在关键表<code>ods_telemetry.cai_api_use</code>上缺乏必要的索引，导致大量慢查询。该表被12次慢查询直接或间接引用，占总慢查询的22.6%，并贡献了超过50%的总数据扫描量。</p>
            <p class="text-gray-700 mb-4">根本原因在于数据库设计阶段未充分考虑查询模式，应用层开发中存在SELECT *和无限制排序的不良实践。这些问题在数据量增长后集中爆发，严重影响系统稳定性和用户体验。</p>
            <p class="text-gray-700 mb-4">通过实施本报告提出的优化建议，预计可消除80%以上的慢查询，将平均查询响应时间从6.72秒降低至1秒以内，显著提升系统性能和稳定性。建议技术团队立即启动优化计划，优先处理高优先级索引创建任务。</p>
            <p class="text-gray-700 mb-4">长期来看，应建立数据库设计规范和代码审查机制，将索引设计、查询优化作为开发流程的必要环节，避免类似问题再次发生。</p>
        </div>
    </section>

    <section class="mb-12">
        <h2 class="section-title">六、参考文献</h2>
        <div class="reference">
            [[1]]、<cite><a href="https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html" target="_blank" rel="noopener noreferrer">MySQL官方文档：索引优化</a></cite>
        </div>
        <div class="reference">
            [[2]]、<cite><a href="https://www.postgresql.org/docs/current/indexes.html" target="_blank" rel="noopener noreferrer">PostgreSQL官方文档：索引类型与使用</a></cite>
        </div>
        <div class="reference">
            [[3]]、<cite><a href="https://www.percona.com/blog/2019/05/22/why-select-is-bad/" target="_blank" rel="noopener noreferrer">Percona博客：为什么SELECT *是坏习惯</a></cite>
        </div>
        <div class="reference">
            [[4]]、<cite><a href="https://www.mongodb.com/blog/post/10-common-sql-patterns-and-how-to-optimize-them-for-mongodb" target="_blank" rel="noopener noreferrer">MongoDB博客：常见SQL模式及优化</a></cite>
        </div>
        <div class="reference">
            [[5]]、<cite><a href="https://www.datadoghq.com/blog/database-performance-optimization/" target="_blank" rel="noopener noreferrer">Datadog博客：数据库性能优化最佳实践</a></cite>
        </div>
    </section>

    <footer>
        Created by Autobots<br>
        页面内容均由 AI 生成，仅供参考
    </footer>

    <script>
        // 简单的交互增强：折叠/展开详细信息
        document.addEventListener('DOMContentLoaded', function() {
            const accordionButtons = document.querySelectorAll('.accordion-button');
            accordionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    if (content.style.display === 'block') {
                        content.style.display = 'none';
                    } else {
                        content.style.display = 'block';
                    }
                });
            });
        });
    </script>
</body>
</html>
